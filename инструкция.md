# Документация по системе управления пользователями

Эта документация предоставляет обзор системы управления пользователями, включая её архитектуру, инструкции по настройке, API-эндпоинты и рекомендации по тестированию.

## Содержание

1. [Обзор](#обзор)
2. [Архитектура](#архитектура)
3. [Инструкции по настройке](#инструкции-по-настройке)
4. [API-эндпоинты](#api-эндпоинты)
5. [Тестирование](#тестирование)
6. [Сущности](#сущности)
7. [Обработка ошибок](#обработка-ошибок)

## Обзор

Система управления пользователями — это бэкенд-приложение, разработанное с использованием NestJS, TypeORM и MySQL. Оно предоставляет функциональность для управления пользователями и ролями, включая создание, обновление, удаление и получение данных о пользователях и ролях. Система контейнеризована с использованием Docker, что упрощает её развертывание и запуск в любой среде.

## Архитектура

Система состоит из следующих компонентов:

- **Nginx**: Выступает в роли обратного прокси-сервера для маршрутизации запросов к соответствующим сервисам.
- **Сервис управления пользователями**: Приложение на NestJS, которое обрабатывает управление пользователями и ролями.
- **База данных MySQL**: Хранит данные о пользователях и ролях.

## Инструкции по настройке

### Требования

- Docker
- Docker Compose

### Шаги для запуска проекта

1. **Распакуйте проект**

   ```bash
   cd <директория-проекта>
   ```

2. **Соберите и запустите Docker-контейнеры**

   ```bash
   docker-compose up --build
   ```

3. **Доступ к приложению**

   Приложение будет доступно по адресу `http://localhost:8000`.

## API-эндпоинты

### Пользователи

- **GET `/users`**: Получить всех пользователей.
- **GET `/users/:login`**: Получить пользователя по логину.
- **POST `/users`**: Создать нового пользователя.
- **PUT `/users/:login`**: Обновить данные пользователя по логину.
- **DELETE `/users/:login`**: Удалить пользователя по логину.

### Роли

- **GET `/roles`**: Получить все роли.
- **POST `/roles`**: Создать новую роль.
- **DELETE `/roles/:id`**: Удалить роль по ID.

## Тестирование

### Юнит-тесты

Юнит-тесты написаны с использованием Jest и расположены в соответствующих директориях сервисов. При сборке проекта через docker compose тесты будут запущены прямо перед запуском сервиса. Тесты, которые запрошены по заданию лежат по пути user-management/src/tests
Так же были добавлены тесты на endpoint-ы для ролей.

Для запуска тестов:

```bash
cd user-management
npm run test
```

## Сущности

### Пользователь (User)

- **login**: Первичный ключ, уникальный идентификатор пользователя.
- **name**: Имя пользователя.
- **password**: Пароль пользователя.
- **roles**: Связь "многие ко многим" с сущностью `Role`.

### Роль (Role)

- **id**: Первичный ключ, автоматически генерируемый идентификатор роли.
- **name**: Название роли.
- **users**: Связь "многие ко многим" с сущностью `User`.

## Обработка ошибок

Система обрабатывает ошибки корректно и возвращает согласованные ответы об ошибках. Основные типы ошибок:

- **400 Bad Request**: Возвращается, если данные запроса некорректны.
- **404 Not Found**: Возвращается, если запрашиваемый ресурс не найден.
- **500 Internal Server Error**: Возвращается для непредвиденных ошибок.

### Пример ответа об ошибке

```json
{
  "success": false,
  "errors": ["User is not found"]
}
```
